<!DOCTYPE html>
<html lang="en">

<head>
</head>

<body>
    <div id="messenger-layout" class="row">
        <div class="col-2 d-none d-sm-block"></div>
        <div class="col-3 sec-1 d-none d-md-block">
            <div class="search row p-2 pl-4">
                <input type="text" placeholder="Search" aria-label="Search">
                <i class="fas fa-search fa-md"></i>
            </div>
            <div class="head">Messages</div>

            <div class="people-list">
                <% var firstuser=undefined;
                for(var i=0; i < contacts.length; i++){
                        var avatar = undefined;
                        var username = undefined;
                        if(contacts[i].sender_id != userid){
                            for(var j=0; j < profile.length; j++){
                                if(profile[j].user_id == contacts[i].sender_id){
                                    avatar = profile[j].avatar;
                                    username = profile[j].username.slice(1,-1);
                                    if(firstuser == undefined)
                                        firstuser = profile[j];
                                    break;  
                                }
                            }
                        }else{
                            for(var j=0; j < profile.length; j++){
                                if(profile[j].user_id == contacts[i].reciever_id){
                                    avatar = profile[j].avatar;
                                    username = profile[j].username.slice(1,-1);
                                    if(firstuser == undefined)
                                        firstuser = profile[j];
                                    break;  
                                }
                            }
                        }
                        %>
                <div class="row" onclick="gotoUserMessage()">
                    <div class="col-1 pl-0">
                        <i class="fas fa-user-circle fa-2x mt-3"></i>
                    </div>
                    <div class="col ml-3 mt-3">
                        <div class="row ">
                            <div class="font-weight-bold name">
                                <%=username%>

                            </div>
                            <div class="ml-auto"><%=contacts[i].time%></div>
                        </div>
                        <div class="row text-truncate">
                            <%=contacts[i].msg_text%>
                        </div>
                    </div>
                </div>
                <%}%>
                        </div>
                    </div>
                    <div class="col sec-2">
                        <div class="row mt-2 messenger-name">
                            <div class="col-1">
                                <i class="fas fa-user-circle fa-2x"></i>
                            </div>
                            <div class="row name-2 font-weight-bold mt-3 ml-5">
                                <%= firstuser.username.slice(1,-1)%>
            </div>
            <div class="dropleft ml-auto mt-3 mr-3">
                <span class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-h"></i>
                    <div class="dropdown-menu">
                        <div class="dropdown-item">Block</div>
                        <div class="dropdown-item">Report</div>
                    </div>
                </span>
            </div>
        </div>

        <div class="msg-list">
            <% for(var i=0; i < msg_list.length; i++){
                    if(msg_list[i].sender_id == userid){%>
            <div class="my-message text-break mb-0 m-3 ml-auto "> <%= msg_list[i].msg_text%></div>
            <%}else{%>
            <div class="his-message text-break mb-0 m-3 "> <%= msg_list[i].msg_text %></div>
            <%}}%>

            <div class="timestatus">
                <%var time = msg_list[msg_list.length-1].time;
                var hourMin = time.getHours() +":"+ time.getMinutes();
                if(msg_list[msg_list.length-1].sender_id == userid){%>
                    <div class="my-time ml-auto"> <%= hourMin%></div>
                <%}else{%>
                    <div class="his-time ml-3"> <%= hourMin%></div>
                <%}%>
        </div>
    </div>

    <div class="row msg-form">
        <div class="col">
            <div class="md-form mt-1">
                <i class="fas fa-pencil-alt prefix"></i>
                <input id="msg-input" type="text" class="form-control" placeholder="Message">
            </div>
        </div>
        <div class="col-2">
            <div class="msg-submit-btn" onclick="submitMessage()">
                <i class="material-icons md-24 mt-3">send</i>
            </div>
        </div>
    </div>
    </div>
    <div class="col-2 d-none d-sm-block"></div>
    </div>
    <script type="text/javascript" src="../js/messenger.js"></script>
</body>

</html>